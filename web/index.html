<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AccountantAI - Gemini-Powered Finance Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-blue-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold text-indigo-900 mb-4">ğŸ’° AccountantAI</h1>
            <p class="text-xl text-gray-700">Gemini 3-Powered Personal Finance Assistant</p>
            <p class="text-sm text-gray-600 mt-2">Context-Aware Reasoning â€¢ Dynamic Personality â€¢ Multi-Agent Architecture</p>
        </div>

        <!-- Pipeline Visualization -->
        <div class="bg-white rounded-lg shadow-xl p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Complete Data Pipeline</h2>
            
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <!-- Step 1: Plaid -->
                <div class="flex-1 text-center">
                    <div class="bg-green-100 rounded-lg p-6 border-2 border-green-300">
                        <div class="text-4xl mb-2">ğŸ¦</div>
                        <h3 class="font-bold text-lg mb-2">1. Bank Connection</h3>
                        <p class="text-sm text-gray-600">Plaid Link</p>
                        <button id="plaidButton" class="mt-4 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
                            Connect Bank
                        </button>
                    </div>
                </div>

                <div class="text-3xl text-gray-400">â†’</div>

                <!-- Step 2: Backend -->
                <div class="flex-1 text-center">
                    <div class="bg-blue-100 rounded-lg p-6 border-2 border-blue-300">
                        <div class="text-4xl mb-2">âš™ï¸</div>
                        <h3 class="font-bold text-lg mb-2">2. Data Processing</h3>
                        <p class="text-sm text-gray-600">FastAPI Backend</p>
                        <div class="mt-4 text-xs">
                            <span class="bg-blue-200 px-2 py-1 rounded">478 Transactions</span>
                        </div>
                    </div>
                </div>

                <div class="text-3xl text-gray-400">â†’</div>

                <!-- Step 3: Gemini -->
                <div class="flex-1 text-center">
                    <div class="bg-purple-100 rounded-lg p-6 border-2 border-purple-300">
                        <div class="text-4xl mb-2">ğŸ¤–</div>
                        <h3 class="font-bold text-lg mb-2">3. AI Reasoning</h3>
                        <p class="text-sm text-gray-600">Gemini 3 Flash</p>
                        <div class="mt-4 text-xs">
                            <span class="bg-purple-200 px-2 py-1 rounded">thinking_level: high</span>
                        </div>
                    </div>
                </div>

                <div class="text-3xl text-gray-400">â†’</div>

                <!-- Step 4: User -->
                <div class="flex-1 text-center">
                    <div class="bg-indigo-100 rounded-lg p-6 border-2 border-indigo-300">
                        <div class="text-4xl mb-2">ğŸ’¬</div>
                        <h3 class="font-bold text-lg mb-2">4. Personalized Advice</h3>
                        <p class="text-sm text-gray-600">Context-Aware</p>
                        <div class="mt-4 text-xs">
                            <span class="bg-indigo-200 px-2 py-1 rounded">5 Personalities</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Demo Section -->
        <div class="grid md:grid-cols-2 gap-8">
            <!-- Chat Demo -->
            <div class="bg-white rounded-lg shadow-xl p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ’¬ AI Chat Assistant</h3>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Personality</label>
                    <select id="personality" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        <option value="zen_coach">ğŸ§˜ Zen Coach</option>
                        <option value="tough_love">ğŸ’ª Tough Love</option>
                        <option value="supportive">ğŸ¤— Supportive</option>
                        <option value="to_the_point">ğŸ¯ To The Point</option>
                        <option value="no_bs">ğŸ”¥ No BS</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Your Question</label>
                    <input type="text" id="userMessage" 
                           class="w-full border border-gray-300 rounded-lg px-4 py-2" 
                           placeholder="Can I afford a $200 jacket?"
                           value="Can I afford a $200 jacket?">
                </div>

                <button id="askButton" class="w-full bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition font-medium">
                    Ask Gemini 3
                </button>

                <div id="response" class="mt-6 hidden">
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                        <div class="flex items-start gap-3">
                            <div class="text-2xl">ğŸ¤–</div>
                            <div class="flex-1">
                                <div class="text-xs text-gray-500 mb-2">
                                    <span id="agentUsed" class="font-medium"></span> â€¢ 
                                    <span id="toneUsed"></span>
                                </div>
                                <div id="responseText" class="text-sm text-gray-800 whitespace-pre-wrap"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="loading" class="mt-6 hidden text-center">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                    <p class="text-sm text-gray-600 mt-2">Gemini 3 is thinking...</p>
                </div>
            </div>

            <!-- Features -->
            <div class="bg-white rounded-lg shadow-xl p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸš€ Key Features</h3>
                
                <div class="space-y-4">
                    <div class="flex items-start gap-3">
                        <div class="text-2xl">ğŸ§ </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Gemini 3 Flash Preview</h4>
                            <p class="text-sm text-gray-600">Latest model with advanced reasoning and thinking levels</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <div class="text-2xl">ğŸ“Š</div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Context-Aware Analysis</h4>
                            <p class="text-sm text-gray-600">References your actual spending patterns and balance</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <div class="text-2xl">ğŸ­</div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Dynamic Personality</h4>
                            <p class="text-sm text-gray-600">5 communication styles to match your preference</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <div class="text-2xl">ğŸ”</div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Multi-Agent System</h4>
                            <p class="text-sm text-gray-600">Specialized agents for spending, budgeting, investing</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <div class="text-2xl">ğŸ“¸</div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Receipt Understanding</h4>
                            <p class="text-sm text-gray-600">Multimodal OCR with high-resolution processing</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <div class="text-2xl">ğŸ’¡</div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Professional Frameworks</h4>
                            <p class="text-sm text-gray-600">50/30/20 budgeting, emergency fund calculations</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transaction Data Status -->
        <div class="mt-8 bg-white rounded-lg shadow-xl p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ˆ Current Financial Snapshot</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="stats">
                <div class="text-center">
                    <div class="text-3xl font-bold text-indigo-600">478</div>
                    <div class="text-sm text-gray-600">Transactions</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-600">$42,500</div>
                    <div class="text-sm text-gray-600">Income</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-red-600">$39,742</div>
                    <div class="text-sm text-gray-600">Spent</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-blue-600">$2,758</div>
                    <div class="text-sm text-gray-600">Balance</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8000';
        const USER_ID = 'demo_user_123';

        // Plaid Link Handler (Sandbox mode for demo)
        document.getElementById('plaidButton').addEventListener('click', function() {
            // For demo purposes, show what would happen
            alert('ğŸ¦ Plaid Link Demo\n\nIn production, this would:\n1. Open Plaid Link UI\n2. User selects their bank\n3. Authenticates securely\n4. We receive transaction data\n5. Data flows to backend\n\nFor this demo, we\'re using 478 pre-loaded synthetic transactions.');
            
            // Simulate loading transactions
            fetch(`${API_BASE}/load-transactions?user_id=${USER_ID}`, {
                method: 'POST'
            })
            .then(r => r.json())
            .then(data => {
                console.log('Transactions loaded:', data);
                alert(`âœ… Loaded ${data.transactions_loaded} transactions!\n\nTop category: Food & Drink ($${data.top_categories['Food and Drink'].toFixed(2)})`);
            })
            .catch(err => {
                console.error('Error:', err);
                alert('âš ï¸ Make sure backend is running on http://localhost:8000');
            });
        });

        // Chat Handler
        document.getElementById('askButton').addEventListener('click', async function() {
            const message = document.getElementById('userMessage').value;
            const personality = document.getElementById('personality').value;
            
            const responseDiv = document.getElementById('response');
            const loadingDiv = document.getElementById('loading');
            
            responseDiv.classList.add('hidden');
            loadingDiv.classList.remove('hidden');
            
            try {
                const response = await fetch(`${API_BASE}/chat`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        user_id: USER_ID,
                        message: message,
                        personality: personality
                    })
                });
                
                const data = await response.json();
                
                loadingDiv.classList.add('hidden');
                responseDiv.classList.remove('hidden');
                
                document.getElementById('agentUsed').textContent = data.agent_used;
                document.getElementById('toneUsed').textContent = data.tone;
                document.getElementById('responseText').textContent = data.response.response;
                
            } catch (error) {
                loadingDiv.classList.add('hidden');
                alert('âš ï¸ Error connecting to backend. Make sure it\'s running on http://localhost:8000');
                console.error('Error:', error);
            }
        });

        // Load transactions on page load
        window.addEventListener('load', function() {
            fetch(`${API_BASE}/load-transactions?user_id=${USER_ID}`, {
                method: 'POST'
            })
            .then(r => r.json())
            .then(data => {
                console.log('Auto-loaded transactions:', data);
            })
            .catch(err => console.log('Backend not ready yet'));
        });
    </script>
</body>
</html>
